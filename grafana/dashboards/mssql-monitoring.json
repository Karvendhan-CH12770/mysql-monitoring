{
  "uid": "mssql_dashboard_clean",
  "title": "MSSQL",
  "schemaVersion": 38,
  "editable": true,
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "templating": {
    "list": [
      {
        "name": "job",
        "type": "query",
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "query": "label_values(up, job)",
        "refresh": 2
      },
      {
        "name": "instance",
        "type": "query",
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "query": "label_values(up{job=\"$job\"}, instance)",
        "refresh": 2
      },
      {
        "name": "database",
        "type": "query",
        "datasource": {
          "type": "prometheus",
          "uid": "DS_PROMETHEUS"
        },
        "query": "label_values(sqlserver_connections_active{job=\"$job\", instance=\"$instance\"}, database)",
        "refresh": 2,
        "hide": 0
      }
    ]
  },
  "panels": [
    {
      "type": "stat",
      "title": "ACTIVE CONNECTIONS",
      "gridPos": {
        "x": 0,
        "y": 0,
        "w": 6,
        "h": 7
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(sqlserver_connections_active{job=\"$job\", instance=\"$instance\", database=\"$database\"})",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "none"
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "BUFFER CACHE HIT RATIO",
      "gridPos": {
        "x": 6,
        "y": 0,
        "w": 6,
        "h": 7
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "avg(sqlserver_buffer_manager_buffer_cache_hit_ratio{job=\"$job\", instance=\"$instance\"}) * 100",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "BATCH REQUESTS",
      "gridPos": {
        "x": 12,
        "y": 0,
        "w": 6,
        "h": 7
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(sqlserver_batch_requests_total{job=\"$job\", instance=\"$instance\"}[5m]))",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "req/s"
        },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "DEADLOCKS",
      "gridPos": {
        "x": 18,
        "y": 0,
        "w": 6,
        "h": 7
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(increase(sqlserver_deadlocks_total{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m]))",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Connections",
      "gridPos": {
        "x": 0,
        "y": 7,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(sqlserver_connections_active{job=\"$job\", instance=\"$instance\", database=\"$database\"})",
          "legendFormat": "Connections",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Query Execution Time (ms)",
      "gridPos": {
        "x": 8,
        "y": 7,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "rate(sqlserver_query_duration_seconds{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m]) * 1000",
          "legendFormat": "All",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ms"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Deadlocks per Second",
      "gridPos": {
        "x": 16,
        "y": 7,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "rate(sqlserver_deadlocks_total{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m])",
          "legendFormat": "Deadlocks/s",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Page Life Expectancy",
      "gridPos": {
        "x": 0,
        "y": 17,
        "w": 6,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "avg(sqlserver_buffer_manager_page_life_expectancy_seconds{job=\"$job\", instance=\"$instance\"})",
          "legendFormat": "PLE",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "I/O Operations (Reads)",
      "gridPos": {
        "x": 6,
        "y": 17,
        "w": 6,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(sqlserver_io_read_operations_total{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m]))",
          "legendFormat": "Reads/s",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "req/s"
        },
        "overrides": []
      }
    },
    {
      "type": "gauge",
      "title": "Deadlocks per Second",
      "gridPos": {
        "x": 12,
        "y": 17,
        "w": 6,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "rate(sqlserver_deadlocks_total{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m])",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "orange",
                "value": 1
              },
              {
                "color": "red",
                "value": 5
              }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "type": "gauge",
      "title": "Index Usage",
      "gridPos": {
        "x": 18,
        "y": 17,
        "w": 6,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "avg(sqlserver_index_usage_percent{job=\"$job\", instance=\"$instance\", database=\"$database\"})",
          "range": true
        }
      ],
      "options": {
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              },
              {
                "color": "orange",
                "value": 50
              },
              {
                "color": "green",
                "value": 70
              }
            ]
          }
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Log File Used (%)",
      "gridPos": {
        "x": 0,
        "y": 27,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "avg(sqlserver_database_log_used_percent{job=\"$job\", instance=\"$instance\", database=\"$database\"})",
          "legendFormat": "Log Used %",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Top Waits (rate, s/s)",
      "gridPos": {
        "x": 8,
        "y": 27,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "topk(5, rate(sqlserver_waits_seconds_total{job=\"$job\", instance=\"$instance\"}[5m]))",
          "legendFormat": "{{wait_type}}",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "s/s"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "Log Flushes per Second",
      "gridPos": {
        "x": 16,
        "y": 27,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(sqlserver_log_flushes_total{job=\"$job\", instance=\"$instance\", database=\"$database\"}[5m]))",
          "legendFormat": "Log Flushes/s",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "req/s"
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "TempDB Usage (bytes)",
      "gridPos": {
        "x": 0,
        "y": 37,
        "w": 8,
        "h": 10
      },
      "datasource": {
        "type": "prometheus",
        "uid": "DS_PROMETHEUS"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "avg(sqlserver_tempdb_bytes{job=\"$job\", instance=\"$instance\"})",
          "legendFormat": "TempDB bytes",
          "range": true
        }
      ],
      "options": {
        "legend": {
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        },
        "overrides": []
      }
    }
  ]
}