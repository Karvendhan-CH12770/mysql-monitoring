groups:
  - name: mysql_alerts
    interval: 30s
    rules:
      - alert: MysqlDown
        expr: mysql_up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MySQL instance is down"
          description: "MySQL database is down on {{ $labels.instance }}"

      - alert: MysqlTooManyConnections
        expr: max_over_time(mysql_global_status_threads_connected[5m]) / mysql_global_variables_max_connections * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL has too many connections"
          description: "More than 80% of MySQL connections are in use on {{ $labels.instance }}"

      - alert: MysqlSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL slow queries detected"
          description: "MySQL has slow queries on {{ $labels.instance }}"

      - alert: MysqlReplicationLag
        expr: mysql_slave_status_seconds_behind_master > 30
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL replication lag"
          description: "MySQL replication lag is {{ $value }}s on {{ $labels.instance }}"

      - alert: MysqlInnodbLogWaits
        expr: rate(mysql_global_status_innodb_log_waits[5m]) > 10
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MySQL InnoDB log waits"
          description: "MySQL InnoDB log waits detected on {{ $labels.instance }}"
